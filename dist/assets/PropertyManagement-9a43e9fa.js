import{r as m,a as v,s as c,j as s,B as d,m as w}from"./index-b4b9cf58.js";import{B as N}from"./building-438c0c6e.js";import{M as P}from"./map-pin-928db7a5.js";import{I as b}from"./image-bd792144.js";import{P as E}from"./pen-square-5ef01a24.js";import{T as S}from"./trash-2-c81e4f83.js";const $=()=>{const[o,l]=m.useState([]),[x,p]=m.useState(!0),{toast:r}=v();m.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:e,error:t}=await c.from("properties").select(`
          *,
          landlord:landlord_id(name),
          agent:agent_id(name)
        `).order("created_at",{ascending:!1});if(t)throw t;l(e),p(!1)}catch{r({variant:"destructive",title:"Error",description:"Failed to load properties"}),p(!1)}},g=async e=>{try{const{data:t,error:a}=await c.from("properties").insert([e]).select().single();if(a)throw a;l([t,...o]),r({title:"Success",description:"Property created successfully"})}catch(t){r({variant:"destructive",title:"Error",description:t.message})}},u=async(e,t)=>{try{const{data:a,error:i}=await c.from("properties").update(t).eq("id",e).select().single();if(i)throw i;l(o.map(n=>n.id===e?a:n)),r({title:"Success",description:"Property updated successfully"})}catch(a){r({variant:"destructive",title:"Error",description:a.message})}},h=async e=>{try{const{error:t}=await c.from("properties").delete().eq("id",e);if(t)throw t;l(o.filter(a=>a.id!==e)),r({title:"Success",description:"Property deleted successfully"})}catch(t){r({variant:"destructive",title:"Error",description:t.message})}},y=async(e,t)=>{try{const a=t.name.split(".").pop(),i=`${e}/${Date.now()}.${a}`,{error:n}=await c.storage.from("property-images").upload(i,t);if(n)throw n;const{data:j}=c.storage.from("property-images").getPublicUrl(i);await u(e,{images:c.postgres.arr_append("images",j.publicUrl)}),r({title:"Success",description:"Image uploaded successfully"})}catch(a){r({variant:"destructive",title:"Error",description:a.message})}};return x?s.jsx("div",{children:"Loading properties..."}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Property Management"}),s.jsxs(d,{onClick:()=>g({name:"New Property",address:"123 Main St",type:"Apartment",status:"available"}),children:[s.jsx(N,{className:"h-4 w-4 mr-2"}),"Add Property"]})]}),s.jsx("div",{className:"grid gap-4",children:o.map(e=>s.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white p-4 rounded-lg shadow-sm",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",children:e.name}),s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx(P,{className:"h-4 w-4 inline mr-1"}),e.address]}),s.jsxs("div",{className:"flex space-x-2 mt-2",children:[s.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded-full",children:e.type}),s.jsx("span",{className:"text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full",children:e.status})]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(d,{size:"sm",variant:"outline",onClick:()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=a=>{var i;(i=a.target.files)!=null&&i[0]&&y(e.id,a.target.files[0])},t.click()},children:s.jsx(b,{className:"h-4 w-4"})}),s.jsx(d,{size:"sm",variant:"outline",onClick:()=>u(e.id,{...e,name:`${e.name} (Updated)`}),children:s.jsx(E,{className:"h-4 w-4"})}),s.jsx(d,{size:"sm",variant:"destructive",onClick:()=>h(e.id),children:s.jsx(S,{className:"h-4 w-4"})})]})]})},e.id))})]})};export{$ as default};
