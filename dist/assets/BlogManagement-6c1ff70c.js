import{r as d,a as z,j as e,m as I,X as N,B as m}from"./index-b4b9cf58.js";import{B as p,L as h,I as w,T as S,C as L,a as P,P as U}from"./BlogService-59bf779b.js";import{U as T}from"./upload-a411e5eb.js";import{P as M}from"./plus-5ca0b280.js";import{f as A}from"./index-c4405eea.js";import{E as O}from"./eye-546d63e0.js";import{T as R}from"./trash-2-c81e4f83.js";function J(){const[j,x]=d.useState([]),[B,g]=d.useState(!0),[i,v]=d.useState(null),[a,o]=d.useState({title:"",content:"",published:!1,image:null}),{toast:n}=z();d.useEffect(()=>{b()},[]);const b=async()=>{try{const s=await p.getBlogs();console.log("BLOGS LOADED:",s),x(s||[]),g(!1)}catch(s){console.error("Error loading blogs:",s),n({variant:"destructive",title:"Load failed",description:"Failed to load blog posts"}),g(!1)}},u=s=>{const{name:t,value:r}=s.target;o(l=>({...l,[t]:r}))},C=s=>{o(t=>({...t,published:s}))},E=async s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t)try{g(!0);const l=`https://source.unsplash.com/random/800x600?${encodeURIComponent(t.name.split(".")[0])}`;o(c=>({...c,image:l})),n({title:"Image placeholder created",description:"A placeholder image has been generated"})}catch(l){console.error("Error handling image:",l),n({variant:"destructive",title:"Image handling failed",description:l.message||"Failed to process image"})}finally{g(!1)}},F=s=>{v(s),o({title:s.title,content:s.content,published:s.published||!1,image:s.image})},y=()=>{v(null),o({title:"",content:"",published:!1,image:null})},k=async s=>{if(confirm("Are you sure you want to delete this blog post?"))try{await p.deleteBlog(s),x(t=>t.filter(r=>r.id!==s)),n({title:"Blog deleted",description:"Blog post has been deleted successfully"})}catch(t){console.error("Error deleting blog:",t),n({variant:"destructive",title:"Delete failed",description:t.message||"Failed to delete blog post"})}},D=async s=>{s.preventDefault();try{const r={title:a.title,content:a.content,published:a.published,summary:a.content.substring(0,150)+"...",...a.image!==((i==null?void 0:i.image)||null)&&{image:a.image},author_id:1};let l;i?(l=await p.updateBlog(i.id,r),x(c=>c.map(f=>f.id===i.id?{...f,...l}:f)),n({title:"Blog updated",description:"Blog post has been updated successfully"})):(l=await p.createBlog(r),x(c=>[l,...c]),n({title:"Blog created",description:"New blog post has been created successfully"})),y(),b()}catch(t){console.error("Error saving blog:",t),n({variant:"destructive",title:"Save failed",description:t.message||"Failed to save blog post"})}};return e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Blog Management"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage your blog posts"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:i?"Edit Blog Post":"Create New Blog Post"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"title",children:"Title"}),e.jsx(w,{id:"title",name:"title",value:a.title,onChange:u,placeholder:"Enter blog title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"content",children:"Content"}),e.jsx(S,{id:"content",name:"content",value:a.content,onChange:u,placeholder:"Enter the blog content",required:!0,rows:10})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"image",children:"Featured Image"}),a.image&&e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"relative aspect-video w-full max-w-md overflow-hidden rounded-md border",children:[e.jsx("img",{src:a.image,alt:"Blog featured image",className:"h-full w-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>o(s=>({...s,image:null})),className:"absolute top-2 right-2 rounded-full bg-red-500 p-1 text-white hover:bg-red-600",children:e.jsx(N,{size:14})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(h,{htmlFor:"image-upload",className:"flex cursor-pointer items-center gap-2 rounded-md border px-3 py-2 hover:bg-muted",children:[e.jsx(T,{size:16}),e.jsx("span",{children:a.image?"Change Image":"Upload Image"}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",onChange:E,className:"hidden"})]}),e.jsx(w,{id:"image-url",name:"image",placeholder:"Or enter image URL directly",value:a.image||"",onChange:u,className:"flex-1"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"published",checked:a.published,onCheckedChange:C}),e.jsx(h,{htmlFor:"published",className:"cursor-pointer",children:"Publish this blog post"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{type:"submit",className:"flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:16}),"Update Blog"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{size:16}),"Create Blog"]})}),i&&e.jsxs(m,{type:"button",variant:"outline",onClick:y,className:"flex items-center gap-2",children:[e.jsx(N,{size:16}),"Cancel"]})]})]})]}),e.jsxs("div",{className:"bg-card rounded-lg shadow-sm overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-semibold p-6 pb-4 border-b",children:"Blog Posts"}),B?e.jsx("div",{className:"p-6 text-center",children:"Loading blogs..."}):j.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No blog posts found."}):e.jsx("div",{className:"divide-y",children:j.map(s=>{var t;return e.jsxs("div",{className:"p-6 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-row gap-4",children:[s.image&&e.jsx("div",{className:"hidden sm:block h-20 w-32 flex-shrink-0 overflow-hidden rounded-md",children:e.jsx("img",{src:s.image,alt:s.title,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),!s.published&&e.jsx("span",{className:"bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded",children:"Draft"})]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1 line-clamp-2",children:s.content}),e.jsxs("div",{className:"text-gray-500 text-xs mt-2",children:[(t=s.author)!=null&&t.name?`By ${s.author.name} â€¢ `:"",A(new Date(s.created_at),"MMM d, yyyy")]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2 md:mt-0",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>window.open(`/blogs/${s.id}`,"_blank"),className:"flex items-center gap-1",children:[e.jsx(O,{size:14}),"View"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>F(s),className:"flex items-center gap-1",children:[e.jsx(U,{size:14}),"Edit"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>k(s.id),className:"flex items-center gap-1 text-red-500 hover:text-red-700",children:[e.jsx(R,{size:14}),"Delete"]})]})]},s.id)})})]})]})]})})}export{J as default};
