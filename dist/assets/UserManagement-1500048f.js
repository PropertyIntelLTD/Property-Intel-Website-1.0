import{r as m,a as y,s as i,j as s,B as d,m as v}from"./index-f1002576.js";import{U as g}from"./user-plus-a1070bf4.js";import{K as U}from"./key-d4a8a2a1.js";import{P as N}from"./pen-square-492384b0.js";import{T as E}from"./trash-2-3d7382ac.js";const q=()=>{const[o,n]=m.useState([]),[h,p]=m.useState(!0),{toast:t}=y();m.useEffect(()=>{u()},[]);const u=async()=>{try{const{data:e,error:r}=await i.from("users").select("*").order("created_at",{ascending:!1});if(r)throw r;n(e),p(!1)}catch{t({variant:"destructive",title:"Error",description:"Failed to load users"}),p(!1)}},x=async e=>{try{const{data:r,error:a}=await i.auth.admin.createUser({email:e.email,password:e.password,email_confirm:!0});if(a)throw a;const{data:l,error:c}=await i.from("users").insert([{id:r.user.id,email:e.email,name:e.name,role:e.role}]).select().single();if(c)throw c;n([l,...o]),t({title:"Success",description:"User created successfully"})}catch(r){t({variant:"destructive",title:"Error",description:r.message})}},f=async(e,r)=>{try{const{data:a,error:l}=await i.from("users").update(r).eq("id",e).select().single();if(l)throw l;n(o.map(c=>c.id===e?a:c)),t({title:"Success",description:"User updated successfully"})}catch(a){t({variant:"destructive",title:"Error",description:a.message})}},w=async e=>{try{const{error:r}=await i.from("users").delete().eq("id",e);if(r)throw r;n(o.filter(a=>a.id!==e)),t({title:"Success",description:"User deleted successfully"})}catch(r){t({variant:"destructive",title:"Error",description:r.message})}},j=async e=>{try{const{error:r}=await i.auth.resetPasswordForEmail(e);if(r)throw r;t({title:"Success",description:"Password reset email sent"})}catch(r){t({variant:"destructive",title:"Error",description:r.message})}};return h?s.jsx("div",{children:"Loading users..."}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),s.jsxs(d,{onClick:()=>x({email:"new@example.com",password:"temppass123",name:"New User",role:"tenant"}),children:[s.jsx(g,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),s.jsx("div",{className:"grid gap-4",children:o.map(e=>s.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white p-4 rounded-lg shadow-sm",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.email}),s.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded-full",children:e.role})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(d,{size:"sm",variant:"outline",onClick:()=>j(e.email),children:s.jsx(U,{className:"h-4 w-4"})}),s.jsx(d,{size:"sm",variant:"outline",onClick:()=>f(e.id,{...e,name:`${e.name} (Updated)`}),children:s.jsx(N,{className:"h-4 w-4"})}),s.jsx(d,{size:"sm",variant:"destructive",onClick:()=>w(e.id),children:s.jsx(E,{className:"h-4 w-4"})})]})]})},e.id))})]})};export{q as default};
