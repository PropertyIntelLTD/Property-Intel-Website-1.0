import{u as C,r as n,a as S,s as l,j as e,L as y,B as o,m as f}from"./index-b4b9cf58.js";import{A as v}from"./arrow-left-a24d44f7.js";import{f as g}from"./index-c4405eea.js";import{C as T}from"./clock-e5ab6bdb.js";import{C as M}from"./check-circle-f980e3c6.js";const D=()=>{const{id:i}=C(),[s,m]=n.useState(null),[u,x]=n.useState([]),[d,p]=n.useState(""),[N,h]=n.useState(!0),{toast:r}=S();n.useEffect(()=>{b(),k()},[i]);const b=async()=>{try{const{data:t,error:a}=await l.from("support_tickets").select(`
          *,
          user:user_id(name, email)
        `).eq("id",i).single();if(a)throw a;m(t),h(!1)}catch{r({variant:"destructive",title:"Error",description:"Failed to load ticket details"}),h(!1)}},k=async()=>{try{const{data:t,error:a}=await l.from("support_ticket_comments").select(`
          *,
          user:user_id(name)
        `).eq("ticket_id",i).order("created_at",{ascending:!0});if(a)throw a;x(t)}catch{r({variant:"destructive",title:"Error",description:"Failed to load comments"})}},w=async t=>{if(t.preventDefault(),!!d.trim())try{const{data:a,error:c}=await l.from("support_ticket_comments").insert([{ticket_id:i,user_id:s.user_id,comment:d}]).select(`
          *,
          user:user_id(name)
        `).single();if(c)throw c;x([...u,a]),p(""),r({title:"Success",description:"Comment added successfully"})}catch{r({variant:"destructive",title:"Error",description:"Failed to add comment"})}},j=async t=>{try{const{data:a,error:c}=await l.from("support_tickets").update({status:t}).eq("id",i).select().single();if(c)throw c;m({...s,status:a.status}),r({title:"Success",description:"Ticket status updated successfully"})}catch{r({variant:"destructive",title:"Error",description:"Failed to update ticket status"})}},_=t=>{switch(t){case"open":return"bg-yellow-100 text-yellow-600";case"in_progress":return"bg-blue-100 text-blue-600";case"resolved":return"bg-green-100 text-green-600";case"closed":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-600"}};return N?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:"Loading ticket details..."})}):s?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx(y,{to:"/support/tickets",children:e.jsxs(o,{variant:"outline",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Back to Tickets"]})})}),e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.subject}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Created by: ",s.user.name]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:g(new Date(s.created_at),"MMM d, yyyy 'at' h:mm a")}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`px-3 py-1 rounded-full ${_(s.status)}`,children:s.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[s.status!=="resolved"&&e.jsxs(o,{variant:"outline",onClick:()=>j("in_progress"),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Mark In Progress"]}),s.status!=="closed"&&e.jsxs(o,{variant:"outline",onClick:()=>j("resolved"),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Mark Resolved"]})]})]}),e.jsx("div",{className:"prose max-w-none mb-8",children:e.jsx("p",{className:"text-gray-600",children:s.message})}),e.jsxs("div",{className:"border-t pt-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Comments"}),e.jsx("div",{className:"space-y-6 mb-8",children:u.map(t=>e.jsxs(f.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.user.name}),e.jsx("p",{className:"text-sm text-gray-500",children:g(new Date(t.created_at),"MMM d, yyyy 'at' h:mm a")})]})}),e.jsx("p",{className:"mt-2",children:t.comment})]},t.id))}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("textarea",{value:d,onChange:t=>p(t.target.value),placeholder:"Add a comment...",className:"w-full p-3 border rounded-lg",rows:4,required:!0}),e.jsx(o,{type:"submit",children:"Add Comment"})]})]})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Ticket not found"}),e.jsx(y,{to:"/support/tickets",children:e.jsxs(o,{children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Back to Tickets"]})})]})})};export{D as default};
